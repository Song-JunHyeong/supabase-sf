# ═══════════════════════════════════════════════════════════════════════════════
# Supabase Self-Hosted Configuration
# ═══════════════════════════════════════════════════════════════════════════════
#
# Copy this file to .env and edit values before first deployment.
# Run: ./scripts/init-instance.sh to auto-generate secure values.
#
# ═══════════════════════════════════════════════════════════════════════════════

# ═══════════════════════════════════════════════════════════════════════════════
# INSTANCE CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
# Unique name for this instance. Used for container names and project isolation.
# Change this to run multiple Supabase instances on the same VPS.
# Example: supabase, supabase-prod, supabase-staging, myapp-db

INSTANCE_NAME=supabase

############################################################
# ⚠️  WARNING: IMMUTABLE AFTER FIRST DEPLOYMENT
#
# The following secrets are "baked in" during initial setup:
# - POSTGRES_PASSWORD: Stored in 5 DB roles
# - JWT_SECRET: Stored in DB settings (app.settings.jwt_secret)
# - VAULT_ENC_KEY: Used by Supavisor for encryption
# - ANON_KEY/SERVICE_ROLE_KEY: JWT tokens signed with JWT_SECRET
#
# Changing these in .env AFTER deployment will BREAK your system.
# To rotate keys safely, see: docs/KEY_ROTATION.md
############################################################


# ═══════════════════════════════════════════════════════════════════════════════
# SECRETS (MUST change before first deployment)
# ═══════════════════════════════════════════════════════════════════════════════

# Database password (use ./scripts/init-instance.sh to generate)
POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password

# JWT signing key (32+ characters, use ./scripts/init-instance.sh to generate)
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long

# JWT tokens (regenerate if JWT_SECRET changes)
ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE
SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q

# Studio dashboard login
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD=this_password_is_insecure_and_should_be_updated

# Encryption keys (32+ characters each)
SECRET_KEY_BASE=UpNVntn3cDxHJpq99YMc1T1AQgQpc8kfYTuRgBiYa15BLrx8etQoXz3gZv1/u2oq
VAULT_ENC_KEY=your-encryption-key-32-chars-min
PG_META_CRYPTO_KEY=your-encryption-key-32-chars-min


# ═══════════════════════════════════════════════════════════════════════════════
# DATABASE
# ═══════════════════════════════════════════════════════════════════════════════

POSTGRES_HOST=db
POSTGRES_DB=postgres
POSTGRES_PORT=5432


# ═══════════════════════════════════════════════════════════════════════════════
# CONNECTION POOLER (Supavisor)
# ═══════════════════════════════════════════════════════════════════════════════

POOLER_PROXY_PORT_TRANSACTION=6543
POOLER_DEFAULT_POOL_SIZE=20
POOLER_MAX_CLIENT_CONN=100
POOLER_TENANT_ID=your-tenant-id
POOLER_DB_POOL_SIZE=5


# ═══════════════════════════════════════════════════════════════════════════════
# API GATEWAY (Kong)
# ═══════════════════════════════════════════════════════════════════════════════

KONG_HTTP_PORT=8000
KONG_HTTPS_PORT=8443


# ═══════════════════════════════════════════════════════════════════════════════
# POSTGREST
# ═══════════════════════════════════════════════════════════════════════════════

PGRST_DB_SCHEMAS=public,storage,graphql_public


# ═══════════════════════════════════════════════════════════════════════════════
# AUTH (GoTrue)
# ═══════════════════════════════════════════════════════════════════════════════

SITE_URL=http://localhost:3000
ADDITIONAL_REDIRECT_URLS=
JWT_EXPIRY=3600
DISABLE_SIGNUP=false
API_EXTERNAL_URL=http://localhost:8000

# Email Mailer
MAILER_URLPATHS_CONFIRMATION="/auth/v1/verify"
MAILER_URLPATHS_INVITE="/auth/v1/verify"
MAILER_URLPATHS_RECOVERY="/auth/v1/verify"
MAILER_URLPATHS_EMAIL_CHANGE="/auth/v1/verify"

# Email Provider
ENABLE_EMAIL_SIGNUP=true
ENABLE_EMAIL_AUTOCONFIRM=false
SMTP_ADMIN_EMAIL=admin@example.com
SMTP_HOST=supabase-mail
SMTP_PORT=2500
SMTP_USER=fake_mail_user
SMTP_PASS=fake_mail_password
SMTP_SENDER_NAME=fake_sender
ENABLE_ANONYMOUS_USERS=false

# Phone Provider
ENABLE_PHONE_SIGNUP=true
ENABLE_PHONE_AUTOCONFIRM=true


# ═══════════════════════════════════════════════════════════════════════════════
# STUDIO (Dashboard)
# ═══════════════════════════════════════════════════════════════════════════════

STUDIO_DEFAULT_ORGANIZATION=Default Organization
STUDIO_DEFAULT_PROJECT=Default Project
SUPABASE_PUBLIC_URL=http://localhost:8000
OPENAI_API_KEY=


# ═══════════════════════════════════════════════════════════════════════════════
# EDGE FUNCTIONS
# ═══════════════════════════════════════════════════════════════════════════════

FUNCTIONS_VERIFY_JWT=false


# ═══════════════════════════════════════════════════════════════════════════════
# OPTIONAL SERVICES (used with --profile full)
# ═══════════════════════════════════════════════════════════════════════════════

# Set to true to enable image transformation in storage
ENABLE_IMGPROXY=false
IMGPROXY_ENABLE_WEBP_DETECTION=true

# Set to true to enable analytics/logging
ENABLE_ANALYTICS=false
LOGFLARE_PUBLIC_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-public
LOGFLARE_PRIVATE_ACCESS_TOKEN=your-super-secret-and-long-logflare-key-private

# Docker socket (for log collection)
DOCKER_SOCKET_LOCATION=/var/run/docker.sock

# Google Cloud (only for BigQuery analytics backend)
GOOGLE_PROJECT_ID=GOOGLE_PROJECT_ID
GOOGLE_PROJECT_NUMBER=GOOGLE_PROJECT_NUMBER
